<div class="col-md-8 col-md-offset-2 text-center">
  <h1 class="text-nvBlue">Submit Trip Request</h1>
  <br>
  <form class="form-horizontal" id="trpForm" method="get" onsubmit="return false">
  
   <div class="form-group">
      <label class="control-label col-md-3" for="requestor"></label>
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-addon">Name</span>
          <input type="text" class="form-control col-md-6" name="requestor" id="requestor" placeholder="Requestor Full Name"
          required="true">
        </div> <!-- input-group -->
      </div>
    </div> <!-- form-gorup -->
    
    <div class="form-group">
      <label class="control-label col-md-3" for="trpName"></label>
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-addon">Trip</span>
          <input type="text" class="form-control col-md-6" name="trpName"  id="trpName" placeholder="Trip Name" required="true">
        </div> <!-- input-group -->
      </div>
    </div> <!-- form-gorup -->
    
    <div class="form-group">
      <label class="control-label col-md-3" for="trpDesc"></label>
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-addon">Description</span>
          <textarea rows="4" class="form-control col-md-6" name="trpDesc"  id="trpDesc"></textarea>
        </div> <!-- input-group -->
      </div>
    </div> <!-- form-gorup -->
    
    <div class="form-group">
      <label class="control-label col-md-3" for="trpDate"></label>
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-addon">Trip Date</span>
          <input type="date" class="form-control col-md-6" name="trpDate"  id="trpDate" required="true">
        </div> <!-- input-group -->
      </div>
    </div> <!-- form-gorup -->
    
    <div class="form-group">
        <label class="control-label col-md-3" for="trpCostStud"></label>
        <div class="col-md-4">
          <div class="input-group">
            <span class="input-group-addon">Cost/Student</span>
            <input type="number" min="0" class="form-control col-md-3" name="trpCostStud" id="trpCostStud"
                   required="true" step=".01" pattern="[0-9]+([\.|,][0-9]+)?" placeholder="0.00">
          </div> <!-- input-group -->
        </div>
      </div> <!-- form-gorup -->
      
      <div class="form-group">
      <label class="control-label col-md-3" for="collector"></label>
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-addon">Collector</span>
          <input type="text" class="form-control col-md-6" name="collector" id="collector" placeholder="Who will be collecting the money"
          required="true">
        </div> <!-- input-group -->
      </div>
    </div> <!-- form-gorup -->
    
    <div class="form-group">
        <label class="control-label col-md-3" for="trpCostTot"></label>
        <div class="col-md-4">
          <div class="input-group">
            <span class="input-group-addon">Total Cost</span>
            <input type="number" min="0" class="form-control col-md-3" name="trpCostTot" id="trpCostTot"
            step=".01" pattern="[0-9]+([\.|,][0-9]+)?" placeholder="0.00">
          </div> <!-- input-group -->
        </div>
      </div> <!-- form-gorup -->
      
      <div class="form-group">
      <label class="control-label col-md-3" for="trpTrans"></label>
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-addon">Transportation</span>
          <select class="form-control col-md-6" name="trpTrans" id="trpTrans" required="true">
            <option>Yellow School Bus</option>
            <option>Chartered Bus</option>
            <option>Train</option>
            <option>Walk</option>
            <option>Other</option>
          </select>
        </div> <!-- input-group -->
      </div>
    </div> <!-- form-gorup -->
    
    <div class="form-group" id="otherTransGrp" style="display:none">
      <label class="control-label col-md-3" for="trpOthrTrans"></label>
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-addon">If Other</span>
          <input type="text" class="form-control col-md-6" name="trpOthrTrans" id="trpOthrTrans" placeholder="Other Transportation">
        </div> <!-- input-group -->
      </div>
    </div> <!-- form-gorup -->
    
    
      <div class="form-group">
      <label class="control-label col-md-3" for="trpDest"></label>
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-addon">Destination</span>
          <input type="text" class="form-control col-md-6" name="trpDest" id="trpDest" placeholder="Destination"
          required="true">
        </div> <!-- input-group -->
      </div>
    </div> <!-- form-gorup -->
    
    <div class="form-group">
        <label class="control-label col-md-3" for="trpNumStud"></label>
        <div class="col-md-4">
          <div class="input-group">
            <span class="input-group-addon">No. Students</span>
            <input type="number" min="0" class="form-control col-md-3" name="trpNumStud" id="trpNumStud"
                   required="true" step="1" placeholder="Number of Students">
          </div> <!-- input-group -->
        </div>
      </div> <!-- form-gorup -->
      
      <div class="form-group" id="studentsGrp">
      <label class="control-label col-md-3" for="trpStudents"></label>
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-addon">Students</span>
          <button id="trpStudents" class="form-control col-md-6">Select a file</button>
        </div> <!-- input-group -->
        <p id='result'></p>
      </div>
    </div> <!-- form-gorup -->
    
    <div class="pull-center">
      <button class="btn btn-default" id="newReqCancelBtn">Cancel</button>
      <input class="btn btn-primary" type="button" id="newReqSubBtn"
      onclick="google.script.run.withSuccessHandler().submitNewTripRequest(this.form)" value="Submit Trip Request">
    </div>
  
  </form>
</div>



<script>
  $(function(){
    
    var DEVELOPER_KEY = 'AIzaSyCZbnbE1NGsNzRzLRfe7AT2PkqZw_g0OQU';
    var DIALOG_DIMENSIONS = {width: 600, height: 425};
    var pickerApiLoaded = false;
    
    $('#trpTrans').on("change", displayOther);
    $('#trpStudents').popover();
    $('#newReqCancelBtn').click(cancelTrpReq);
    $('#trpStudents').click(getOAuthToken);
    
    gapi.load('picker', {'callback': function() {
      pickerApiLoaded = true;
    }});

     
    function getOAuthToken() {
      google.script.run.withSuccessHandler(createPicker)
          .withFailureHandler(showError).getOAuthToken();
    }
    
    function createPicker(token) {
      console.log(pickerApiLoaded + " | " + token);
      if (pickerApiLoaded && token) {
        console.log("Creating picker");
        var picker = new google.picker.PickerBuilder()
            // Instruct Picker to display only spreadsheets in Drive. For other
            // views, see https://developers.google.com/picker/docs/#otherviews
            .addView(google.picker.ViewId.DOCS)
            // Hide the title bar since an Apps Script dialog already has a title.
            .hideTitleBar()
            .setOAuthToken(token)
            .setDeveloperKey(DEVELOPER_KEY)
            .setCallback(pickerCallback)
            .setOrigin('https://script.google.com')
            // Instruct Picker to fill the dialog, minus 2 pixels for the border.
            .setSize(DIALOG_DIMENSIONS.width - 2,
                DIALOG_DIMENSIONS.height - 2)
            .build();
        picker.setVisible(true);
      } else {
        showError('Unable to load the file picker.');
      }
    }
    
    function pickerCallback(data) {
      var action = data[google.picker.Response.ACTION];
      if (action == google.picker.Action.PICKED) {
        var doc = data[google.picker.Response.DOCUMENTS][0];
        var id = doc[google.picker.Document.ID];
        var url = doc[google.picker.Document.URL];
        var title = doc[google.picker.Document.NAME];
        document.getElementById('result').innerHTML =
            '<b>You chose:</b><br>Name: <a href="' + url + '">' + title +
            '</a><br>ID: ' + id;
      } else if (action == google.picker.Action.CANCEL) {
        document.getElementById('result').innerHTML = 'Picker canceled.';
      }
    }
    
    function showError(message) {
      document.getElementById('result').innerHTML = 'Error: ' + message;
    }
     
    function displayOther(){
      var $trans = $('#trpTrans').val();
      $('#trpOthrTrans').val('');
      $('#otherTransGrp').hide();
      
      if($trans == 'Other'){
        $('#otherTransGrp').show();
      }
    }
    
    function cancelTrpReq(){
      $('#homeBtn').trigger("click");
    }
    
    function subNewTripReq(){
      var $formObj = $('form')[0];
      var $input = $('#trpStudents');
      var $file = $input[0].files[0];
      console.log($file);
      var reader = new FileReader();
      console.log($formObj.trpStudents);
      console.log($formObj);
      console.log($formObj.trpStudents);
        debugger;
       google.script.run.withSuccessHandler().submitNewTripRequest($formObj);
    }
    
  });
</script>
